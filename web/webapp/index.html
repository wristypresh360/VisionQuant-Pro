<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VisionQuant-Pro Web</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <script src="https://unpkg.com/vue@3.4.15/dist/vue.global.prod.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  </head>
  <body>
    <div id="app" class="layout">
      <aside class="sidebar">
        <div class="brand">
          <div class="brand-title">ğŸ¦„ VisionQuant Pro</div>
          <div class="brand-sub">AI å…¨æ ˆé‡åŒ–æŠ•ç ”ç³»ç»Ÿ v8.8 Â· Webè¿ç§»ç‰ˆ</div>
        </div>

        <details class="panel" open>
          <summary class="panel-title">âš™ï¸ æ•°æ®æºè®¾ç½®</summary>
          <div class="field">
            <label>é€‰æ‹©æ•°æ®æº</label>
            <select v-model="dataSource">
              <option value="akshare">AkShare (å…è´¹)</option>
              <option value="jqdata">JQData (èšå®½)</option>
              <option value="rqdata">RQData (ç±³ç­)</option>
            </select>
          </div>
          <div class="tip">ä»˜è´¹æ•°æ®æºéœ€é…ç½®è´¦å·å¯†ç ï¼ˆæ­¤å¤„ä¸ºå¸ƒå±€å¤åˆ»ï¼Œæš‚æœªæ¥å…¥åˆ‡æ¢ï¼‰ã€‚</div>
        </details>

        <div class="panel">
          <div class="panel-title">åŠŸèƒ½æ¨¡å—</div>
          <div class="field">
            <label>æ¨¡å—é€‰æ‹©</label>
            <div class="radio-group">
              <label><input type="radio" value="single" v-model="mode" /> å•åªè‚¡ç¥¨åˆ†æ</label>
              <label><input type="radio" value="batch" v-model="mode" /> æ‰¹é‡ç»„åˆåˆ†æ</label>
            </div>
          </div>
          <div class="field" v-if="mode === 'single'">
            <label>è‚¡ç¥¨ä»£ç </label>
            <input v-model="symbol" placeholder="è¾“å…¥6ä½ä»£ç " />
          </div>
          <div class="field" v-if="mode === 'single'">
            <label>æ—¥æœŸï¼ˆå¯é€‰ï¼‰</label>
            <input v-model="date" placeholder="YYYYMMDD" />
          </div>
          <div class="field" v-if="mode === 'batch'">
            <label>æ‰¹é‡è‚¡ç¥¨ï¼ˆæ¯è¡Œä¸€ä¸ªï¼Œæœ€å¤š30ï¼‰</label>
            <textarea v-model="batchInput" rows="6" placeholder="å¦‚:\n600519\n000001\n300750"></textarea>
          </div>
          <div class="field small">
            <label>TopK</label>
            <input type="number" v-model.number="topK" min="5" max="20" />
          </div>
          <div class="field small checkbox">
            <label>å¤šå°ºåº¦</label>
            <input type="checkbox" v-model="multiScale" />
          </div>
          <button class="primary full" @click="runAnalyze" :disabled="loading">
            {{ loading ? "åˆ†æä¸­..." : "ğŸš€ å¼€å§‹åˆ†æ" }}
          </button>
          <div v-if="error" class="error">{{ error }}</div>
          <div v-if="loading" class="loading">æ­£åœ¨è®¡ç®—ï¼Œè¯·ç¨å€™...</div>
        </div>

        <details class="panel">
          <summary class="panel-title">ğŸ“ˆ å› å­ IC è¯„ä¼°</summary>
          <div class="field">
            <label>è‚¡ç¥¨ä»£ç </label>
            <input v-model="icSymbol" placeholder="å¦‚ 000001" />
          </div>
          <div class="field">
            <label>å¼€å§‹æ—¥æœŸ</label>
            <input v-model="icStart" placeholder="YYYYMMDD" />
          </div>
          <div class="field">
            <label>ç»“æŸæ—¥æœŸ</label>
            <input v-model="icEnd" placeholder="YYYYMMDD" />
          </div>
          <button class="secondary full" @click="runIC" :disabled="icLoading">
            {{ icLoading ? "è®¡ç®—ä¸­..." : "è®¡ç®—IC" }}
          </button>
          <div v-if="icError" class="error">{{ icError }}</div>
          <div v-if="icResult" class="ic-result">
            <div>ICå‡å€¼: {{ formatNum(icResult.ic_mean) }}</div>
            <div>ICIR: {{ formatNum(icResult.ic_ir) }}</div>
            <div>Half-Life: {{ formatNum(icResult.half_life) }}</div>
            <div>ç¨³å®šæ€§: {{ formatNum(icResult.stability) }}</div>
          </div>
        </details>
      </aside>

      <main class="main">
        <!-- å•åªè‚¡ç¥¨åˆ†æ -->
        <div v-if="mode === 'single'">
          <div class="title-block">
            <div class="page-title">ğŸ“Š æ·±åº¦æŠ•ç ”æŠ¥å‘Š: {{ reportTitle }}</div>
          </div>

          <section class="section">
            <div class="section-title">1. è§†è§‰æ¨¡å¼è¯†åˆ«</div>
            <details>
              <summary>â„¹ï¸ æ•°æ®æ¥æºè¯´æ˜</summary>
              <p>ä½¿ç”¨ AttentionCAE æå–ç‰¹å¾ + FAISS æ£€ç´¢ç›¸ä¼¼å½¢æ€ï¼Œç»“åˆDTW/å½¢æ€ç‰¹å¾è¿›è¡Œæ’åºã€‚</p>
            </details>
            <details v-if="overview && overview.quality_report">
              <summary>ğŸ§ª æ•°æ®è´¨é‡æŠ¥å‘Š</summary>
              <pre class="json">{{ overview.quality_report }}</pre>
            </details>
            <div class="query-block" v-if="visual">
              <div class="query-image"><img :src="visual.query.image_b64" alt="query" /></div>
              <div class="metrics">
                <div class="metric"><div class="metric-label">è‚¡ç¥¨</div><div class="metric-value">{{ visual.query.symbol }}</div></div>
                <div class="metric"><div class="metric-label">æ—¥æœŸ</div><div class="metric-value">{{ visual.query.date }}</div></div>
                <div class="metric"><div class="metric-label">ä¼ ç»Ÿèƒœç‡</div><div class="metric-value">{{ formatPercent(visual.metrics.traditional_win_rate) }}</div></div>
                <div class="metric"><div class="metric-label">æ··åˆèƒœç‡</div><div class="metric-value">{{ formatPercent(visual.metrics.hybrid_win_rate) }}</div></div>
                <div class="metric"><div class="metric-label">5æ—¥å‡æ”¶ç›Š</div><div class="metric-value">{{ formatPercent(visual.metrics.avg_future_ret_5d_pct) }}</div></div>
              </div>
            </div>

            <details v-if="visual">
              <summary>ğŸ” ç›¸ä¼¼åº¦åˆ†è§£ï¼ˆå¯è§£é‡Šï¼‰</summary>
              <table class="table">
                <thead>
                  <tr>
                    <th>è‚¡ç¥¨</th><th>æ—¥æœŸ</th><th>DTW</th><th>ç›¸å…³æ€§</th><th>å½¢æ€</th><th>è§†è§‰</th><th>æœ€ç»ˆåˆ†</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(m, idx) in visual.matches" :key="idx">
                    <td>{{ m.symbol }}</td><td>{{ m.date }}</td>
                    <td>{{ formatNum(m.dtw_sim) }}</td><td>{{ formatNum(m.correlation) }}</td>
                    <td>{{ formatNum(m.feature_sim) }}</td><td>{{ formatNum(m.sim_score) }}</td>
                    <td>{{ formatNum(m.score) }}</td>
                  </tr>
                </tbody>
              </table>
            </details>

            <details>
              <summary>ğŸ”¥ æ³¨æ„åŠ›çƒ­åŠ›å›¾ï¼ˆè§£é‡Šæ€§ï¼‰</summary>
              <div class="placeholder">è¿ç§»ä¸­ï¼šAttention heatmap å°†åœ¨ä¸‹ä¸€é˜¶æ®µæ¥å…¥ã€‚</div>
            </details>

            <div class="section-subtitle" v-if="visual">Top10 ç›¸ä¼¼Kçº¿</div>
            <div class="grid" v-if="visual">
              <div class="match-card" v-for="(m, idx) in visual.matches" :key="idx">
                <div class="match-title">Top {{ idx + 1 }} Â· {{ m.symbol }} Â· {{ m.date }}</div>
                <img :src="m.image_b64" alt="match" />
                <div class="match-metrics">
                  <span>DTW: {{ formatNum(m.dtw_sim) }}</span>
                  <span>Corr: {{ formatNum(m.correlation) }}</span>
                  <span>å½¢æ€: {{ formatNum(m.feature_sim) }}</span>
                  <span>è§†è§‰: {{ formatNum(m.sim_score) }}</span>
                </div>
              </div>
            </div>

            <div class="section-subtitle" v-if="visual">æœªæ¥5æ—¥èµ°åŠ¿æ¨æ¼”</div>
            <div id="chart-traj" class="chart" v-if="visual"></div>
            <details v-if="visual">
              <summary>ğŸ“Š æ”¶ç›Šåˆ†å¸ƒä¼°è®¡ï¼ˆæ›´ä¸¥æ ¼ï¼‰</summary>
              <pre class="json">{{ visual.distribution }}</pre>
            </details>
          </section>

          <section class="section">
            <div class="section-title">2. é‡åŒ–å¤šå› å­çœ‹æ¿</div>
            <details>
              <summary>â„¹ï¸ å› å­è¯´æ˜</summary>
              <p>V(è§†è§‰) + F(åŸºæœ¬é¢) + Q(æŠ€æœ¯é¢)ï¼ŒåŠ¨æ€æƒé‡æŒ‰å¸‚åœºregimeè°ƒæ•´ã€‚</p>
            </details>
            <div class="metrics" v-if="overview">
              <div class="metric"><div class="metric-label">AI æ€»è¯„åˆ†</div><div class="metric-value">{{ overview.scorecard.score }}/10 ({{ overview.scorecard.action }})</div></div>
              <div class="metric"><div class="metric-label">ROE</div><div class="metric-value">{{ overview.fundamentals.roe }}%</div></div>
              <div class="metric"><div class="metric-label">PE</div><div class="metric-value">{{ overview.fundamentals.pe_ttm }}</div></div>
              <div class="metric"><div class="metric-label">è¶‹åŠ¿</div><div class="metric-value">{{ overview.technical.MA_Signal > 0 ? "çœ‹æ¶¨" : "çœ‹è·Œ" }}</div></div>
            </div>
            <details v-if="overview">
              <summary>ğŸ“Š æœé‚¦åˆ†æ & å› å­æ˜ç»†</summary>
              <pre class="json">{{ overview.scorecard.details }}</pre>
            </details>
          </section>

          <section class="section">
            <div class="section-title">3. è¡Œä¸šå¯¹æ ‡</div>
            <table class="table" v-if="overview">
              <thead>
                <tr><th>è¡Œä¸š</th><th>è‚¡ç¥¨</th><th>PE</th><th>ROE</th></tr>
              </thead>
              <tbody>
                <tr v-for="(p, idx) in overview.industry.peers" :key="idx">
                  <td>{{ overview.industry.name }}</td>
                  <td>{{ p.symbol || p.è‚¡ç¥¨ä»£ç  || p.ä»£ç  }}</td>
                  <td>{{ p.pe_ttm || p.PE || p['å¸‚ç›ˆç‡'] }}</td>
                  <td>{{ p.roe || p.ROE }}</td>
                </tr>
              </tbody>
            </table>
            <div v-else class="placeholder">è¡Œä¸šå¯¹æ ‡æ•°æ®åŠ è½½ä¸­...</div>
          </section>

          <section class="section">
            <div class="section-title">4. æ–°é—»èˆ†æƒ…</div>
            <details>
              <summary>â„¹ï¸ æ•°æ®æ¥æº</summary>
              <p>AkShare + Google RSS + Yahoo Finance å¤šæºå®¹é”™ã€‚</p>
            </details>
            <div class="news" v-if="overview" v-html="overview.news.replace(/\\n/g,'<br/>')"></div>
          </section>

          <section class="section">
            <div class="section-title">ğŸ§ª å›æµ‹ / ğŸ“ˆ å› å­æœ‰æ•ˆæ€§åˆ†æ</div>
            <div class="tabs">
              <button :class="{active: activeTab==='bt'}" @click="activeTab='bt'">ğŸ§ª å›æµ‹</button>
              <button :class="{active: activeTab==='fa'}" @click="activeTab='fa'">ğŸ“ˆ å› å­æœ‰æ•ˆæ€§åˆ†æ</button>
            </div>
            <div v-if="activeTab==='bt'" class="placeholder">å›æµ‹UIå·²å®Œæˆå¸ƒå±€å¤åˆ»ï¼Œæ¥å£è¿ç§»ä¸­ã€‚</div>
            <div v-if="activeTab==='fa'" class="placeholder">å› å­æœ‰æ•ˆæ€§åˆ†æå¸ƒå±€å·²å®Œæˆï¼Œæ¥å£è¿ç§»ä¸­ã€‚</div>
          </section>

          <section class="section">
            <div class="section-title">5. AI åŸºé‡‘ç»ç†ç»ˆå®¡</div>
            <div class="placeholder">AI å†³ç­–æ¨¡å—æ¥å£è¿ç§»ä¸­ã€‚</div>
          </section>

          <section class="section">
            <div class="section-title">ğŸ’¬ æ™ºèƒ½å¯¹è¯</div>
            <div class="placeholder">èŠå¤©æ¨¡å—æ¥å£è¿ç§»ä¸­ã€‚</div>
          </section>
        </div>

        <!-- æ‰¹é‡ç»„åˆåˆ†æ -->
        <div v-else>
          <div class="title-block">
            <div class="page-title">ğŸ“Š æ‰¹é‡ç»„åˆåˆ†æ</div>
          </div>

          <section class="section" v-if="batch">
            <div class="section-title">âœ… ç»„åˆç»“æœï¼ˆæ ¸å¿ƒ + å¤‡é€‰ï¼‰</div>
            <div class="metrics">
              <div class="metric"><div class="metric-label">ç»„åˆç­–ç•¥</div><div class="metric-value">{{ batch.tier_info.strategy }}</div></div>
              <div class="metric"><div class="metric-label">ä¼˜åŒ–å™¨</div><div class="metric-value">{{ batch.tier_info.optimizer }}</div></div>
              <div class="metric"><div class="metric-label">è¯´æ˜</div><div class="metric-value">{{ batch.tier_info.description }}</div></div>
            </div>

            <details open>
              <summary>æ ¸å¿ƒæ¨èç»„åˆ</summary>
              <pre class="json">{{ batch.weights.core }}</pre>
            </details>
            <details>
              <summary>å¤‡é€‰å¢å¼ºç»„åˆ</summary>
              <pre class="json">{{ batch.weights.enhanced }}</pre>
            </details>
          </section>

          <section class="section" v-if="batch">
            <div class="section-title">ğŸ“Œ ä»“ä½è®¾è®¡ä¸é£æ§è®¾ç½®</div>
            <div class="metrics">
              <div class="metric"><div class="metric-label">æœ€å°ä»“ä½</div><div class="metric-value">5%</div></div>
              <div class="metric"><div class="metric-label">æœ€å¤§ä»“ä½</div><div class="metric-value">25%</div></div>
              <div class="metric"><div class="metric-label">æœ€å¤§æŒä»“æ•°</div><div class="metric-value">10</div></div>
            </div>
          </section>

          <section class="section" v-if="batch">
            <div class="section-title">ğŸ§¾ ç»„åˆé£é™©æŒ‡æ ‡</div>
            <div class="metrics">
              <div class="metric"><div class="metric-label">æœŸæœ›æ”¶ç›Š</div><div class="metric-value">{{ formatPercent(batch.metrics.expected_return) }}</div></div>
              <div class="metric"><div class="metric-label">é£é™©(æ³¢åŠ¨)</div><div class="metric-value">{{ formatPercent(batch.metrics.risk) }}</div></div>
              <div class="metric"><div class="metric-label">Sharpe</div><div class="metric-value">{{ batch.metrics.sharpe_ratio }}</div></div>
              <div class="metric"><div class="metric-label">CVaR(5%)</div><div class="metric-value">{{ formatPercent(batch.metrics.cvar) }}</div></div>
            </div>
          </section>

          <section class="section" v-else>
            <div class="placeholder">è¾“å…¥æ‰¹é‡è‚¡ç¥¨å¹¶å¼€å§‹åˆ†æï¼Œæ˜¾ç¤ºç»„åˆç»“æœã€‚</div>
          </section>
        </div>
      </main>
    </div>

    <script src="/static/app.js"></script>
  </body>
</html>
